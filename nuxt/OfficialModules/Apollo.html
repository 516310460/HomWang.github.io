<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>⚡ Apollo | Hom Wang</title>
    <meta name="description" content="Vue.js、Nuxt.js、Node.js、Flutter">
    <link rel="icon" href="/img/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.5d3f4931.css" as="style"><link rel="preload" href="/assets/js/app.48493ac0.js" as="script"><link rel="preload" href="/assets/js/21.a5434e0f.js" as="script"><link rel="prefetch" href="/assets/js/10.5f780e8b.js"><link rel="prefetch" href="/assets/js/11.ff18f93e.js"><link rel="prefetch" href="/assets/js/12.8ccd9dad.js"><link rel="prefetch" href="/assets/js/13.45786c14.js"><link rel="prefetch" href="/assets/js/14.904ec949.js"><link rel="prefetch" href="/assets/js/15.7026e52d.js"><link rel="prefetch" href="/assets/js/16.aa122a4f.js"><link rel="prefetch" href="/assets/js/17.c23f67fa.js"><link rel="prefetch" href="/assets/js/18.84c480a6.js"><link rel="prefetch" href="/assets/js/19.2aa99af1.js"><link rel="prefetch" href="/assets/js/2.b3ee1790.js"><link rel="prefetch" href="/assets/js/20.7426f68c.js"><link rel="prefetch" href="/assets/js/22.91324fdb.js"><link rel="prefetch" href="/assets/js/23.629d7eae.js"><link rel="prefetch" href="/assets/js/24.e55b2589.js"><link rel="prefetch" href="/assets/js/25.0fcf3352.js"><link rel="prefetch" href="/assets/js/3.7f1d0c20.js"><link rel="prefetch" href="/assets/js/4.8d0d1772.js"><link rel="prefetch" href="/assets/js/5.28cda0e5.js"><link rel="prefetch" href="/assets/js/6.14d6b7e8.js"><link rel="prefetch" href="/assets/js/7.eb9e6cd4.js"><link rel="prefetch" href="/assets/js/8.e774fb1e.js"><link rel="prefetch" href="/assets/js/9.2fb77a96.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d3f4931.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hom Wang</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/nuxt/introduction.html" class="nav-link">Nuxt.js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/516310460" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/jakeWangHong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/0cd8d9f167dc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://vuejs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://nuxtjs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxt.js
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/nuxt/introduction.html" class="nav-link">Nuxt.js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/516310460" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/jakeWangHong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/0cd8d9f167dc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://vuejs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://nuxtjs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxt.js
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/nuxt/introduction.html" class="sidebar-link">介绍</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>官方模块</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/nuxt/OfficialModules/Apollo.html" class="active sidebar-link">⚡ Apollo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nuxt/OfficialModules/Apollo.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/nuxt/OfficialModules/Apollo.html#选项" class="sidebar-link">选项</a></li><li class="sidebar-sub-header"><a href="/nuxt/OfficialModules/Apollo.html#用法" class="sidebar-link">用法</a></li><li class="sidebar-sub-header"><a href="/nuxt/OfficialModules/Apollo.html#认证" class="sidebar-link">认证</a></li><li class="sidebar-sub-header"><a href="/nuxt/OfficialModules/Apollo.html#升级" class="sidebar-link">升级</a></li><li class="sidebar-sub-header"><a href="/nuxt/OfficialModules/Apollo.html#故障排除" class="sidebar-link">故障排除</a></li><li class="sidebar-sub-header"><a href="/nuxt/OfficialModules/Apollo.html#贡献和连线设置" class="sidebar-link">贡献和连线设置</a></li></ul></li><li><a href="/nuxt/OfficialModules/Auth.html" class="sidebar-link">🔑 Auth</a></li><li><a href="/nuxt/OfficialModules/Axios.html" class="sidebar-link">📦 Axios</a></li><li><a href="/nuxt/OfficialModules/PWA.html" class="sidebar-link">⚡ PWA</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>社区模块</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>其他模块</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/nuxt/OtherModules/guess.html" class="sidebar-link">⚡ Guess.js</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/nuxt/Tools/nuxt-generate-cluster.html" class="sidebar-link">Nuxt.js 多线程生成命令</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>教程</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="⚡-apollo"><a href="#⚡-apollo" aria-hidden="true" class="header-anchor">#</a> ⚡ Apollo</h1> <ul><li>在Nuxt.js中使用 <a href="https://github.com/Akryum/vue-apollo" target="_blank" rel="noopener noreferrer">vue-apollo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>使用方法和 <a href="https://github.com/Akryum/vue-cli-plugin-apollo" target="_blank" rel="noopener noreferrer">vue-cli-plugin-apollo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>相同</li></ul> <h2 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h2> <p>yarn 和 npm 安装:</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save @nuxtjs<span class="token operator">/</span>apollo
＃如果您使用<span class="token operator">*</span><span class="token punctuation">.</span>gql或<span class="token operator">*</span><span class="token punctuation">.</span>graphql文件，请先将graphql<span class="token operator">-</span>tag添加到您的依赖项 
npm install <span class="token operator">--</span>save graphql<span class="token operator">-</span>tag
</code></pre></div><p>将 <code>@nuxtjs/apollo</code> 添加到 <code>nuxt.config.js</code> 中的 <code>modules</code> 配置下:</p> <ul><li>clientConfigs: <code>Object</code> 传递给ApolloClient的配置
<ul><li>default: <code>Object</code></li></ul> <blockquote><p>备选</p></blockquote> <ul><li>default: <code>Path</code> // 使用这个可以更好地控制选项</li> <li>otherClient: <code>Object</code> (可选)</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token comment">// Add apollo module</span>
  modules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'@nuxtjs/apollo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token comment">// Give apollo module options</span>
  apollo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    tokenName<span class="token punctuation">:</span> <span class="token string">'yourApolloTokenName'</span><span class="token punctuation">,</span> <span class="token comment">// optional, default: apollo-token</span>
    tokenExpires<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// optional, default: 7 (days)</span>
    includeNodeModules<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// optional, default: false (包括node_modules文件夹中的graphql-tag)</span>
    authenticationType<span class="token punctuation">:</span> <span class="token string">'Basic'</span><span class="token punctuation">,</span> <span class="token comment">// optional, default: 'Bearer'</span>
    <span class="token comment">// optional</span>
    <span class="token function">errorHandler</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%cError'</span><span class="token punctuation">,</span> <span class="token string">'background: red; color: white; padding: 2px 4px; border-radius: 3px; font-weight: bold;'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// required</span>
    clientConfigs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// required  </span>
        httpEndpoint<span class="token punctuation">:</span> <span class="token string">'http://localhost:4000'</span><span class="token punctuation">,</span>
        <span class="token comment">// optional</span>
        <span class="token comment">// See https://www.apollographql.com/docs/link/links/http.html#options</span>
        httpLinkOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          credentials<span class="token punctuation">:</span> <span class="token string">'same-origin'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// You can use `wss` for secure connection (recommended in production)</span>
        <span class="token comment">// Use `null` to disable subscriptions</span>
        wsEndpoint<span class="token punctuation">:</span> <span class="token string">'ws://localhost:4000'</span><span class="token punctuation">,</span> <span class="token comment">// optional</span>
        <span class="token comment">// LocalStorage token</span>
        tokenName<span class="token punctuation">:</span> <span class="token string">'apollo-token'</span><span class="token punctuation">,</span> <span class="token comment">// optional</span>
        <span class="token comment">// Enable Automatic Query persisting with Apollo Engine</span>
        persisting<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// Optional</span>
        <span class="token comment">// Use websockets for everything (no HTTP)</span>
        <span class="token comment">// You need to pass a `wsEndpoint` for this to work</span>
        websocketsOnly<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// Optional</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      test<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        httpEndpoint<span class="token punctuation">:</span> <span class="token string">'http://localhost:5000'</span><span class="token punctuation">,</span>
        wsEndpoint<span class="token punctuation">:</span> <span class="token string">'ws://localhost:5000'</span><span class="token punctuation">,</span>
        tokenName<span class="token punctuation">:</span> <span class="token string">'apollo-token'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 备选：用户配置路径，返回完全相同的配置选项</span>
      test2<span class="token punctuation">:</span> <span class="token string">'~/plugins/my-alternative-apollo-config.js'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>// plugins/my-alternative-apollo-config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    httpEndpoint<span class="token punctuation">:</span> <span class="token string">'http://localhost:4000/graphql-alt'</span><span class="token punctuation">,</span>
    getAuth<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'Bearer my-static-token'</span> <span class="token comment">// 使用此方法覆盖函数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="选项"><a href="#选项" aria-hidden="true" class="header-anchor">#</a> 选项</h2> <p>您可以（在简单的设置中）添加一个如上所述的对象。如果需要覆盖缓存或默认的 <code>getAuth()</code> 函数，则使用配置文件的路径，该路径返回客户端配置选项。</p> <p>clientConfigs <code>Option</code>:必选</p> <p>设置apollo客户端，您在<a href="https://github.com/Akryum/vue-cli-plugin-apollo/blob/master/graphql-client/src/index.js#L15" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>找到所有的可用选项</p> <p>查看官方 <a href="https://github.com/Akryum/vue-cli-plugin-apollo" target="_blank" rel="noopener noreferrer">vue-apollo-cli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，其中提供了相关用法</p> <p>clientConfigs.default <code>Object</code>: 必选</p> <p>clientConfigs. <code>Object|Path</code>: 可选</p> <p>tokenName <code>String</code>: 可选, default: 'apollo-token'</p> <p>在身份验证的情况下将设置的cookie的令牌名称。还可以在每个 <code>clientConfigs</code> 中提供 <code>tokenName</code> 选项以覆盖默认值。当发出每个请求时，这个cookie中任何东西的值都将在以 <code>authenticationType</code> 的指定下，在HTTP header的&quot;Authorization&quot;中发送。</p> <p>authenticationType <code>String</code>: 可选, default: 'Bearer'</p> <p>设置任何授权请求的身份验证类型。如果GraphQL API需要的身份验证类型不是默认值 <code>Bearer</code>，则修改它。然后，所有请求在HTTP header的&quot;Authorization：&quot;（例如: <code>Authorization：Bearer abc123</code>）中发送。</p> <p>如果您的后端需要&quot;Authorization：&quot;格式的Authorization标头，没有任何前缀，那么您应该将此值设置为空字符串。</p> <p>includeNodeModules <code>Boolean</code>：可选，default：false</p> <p>如果您使用<code>node_module</code>文件夹内的<code>*.gql</code>文件，您可以启用<code>graphql-tag/loader</code>为您解析文件。</p> <h2 id="用法"><a href="#用法" aria-hidden="true" class="header-anchor">#</a> 用法</h2> <p><code>vue-apollo</code> 设置完成后，您的项目已成功启用。查看<a href="https://github.com/nuxt/nuxt.js/tree/dev/examples/vue-apollo" target="_blank" rel="noopener noreferrer">官方示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/Akryum/vue-apollo" target="_blank" rel="noopener noreferrer">vue-apollo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>如何在应用程序代码中使用vue-apollo</p> <h2 id="认证"><a href="#认证" aria-hidden="true" class="header-anchor">#</a> 认证</h2> <p>您有以下可用的身份验证方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//设置您的 graphql-token</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$apolloHelpers<span class="token punctuation">.</span><span class="token function">onLogin</span><span class="token punctuation">(</span>token <span class="token comment">/* 如果不是默认值，则可以作为第二个参数传入客户端，并且可以在第三个参数上设置自定义 token 过期 */</span><span class="token punctuation">)</span>
<span class="token comment">//未设置您的 graphql-token</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$apolloHelpers<span class="token punctuation">.</span><span class="token function">onLogout</span><span class="token punctuation">(</span><span class="token comment">/* 如果不是默认值，则可以作为第二个参数传入客户端 */</span><span class="token punctuation">)</span>
<span class="token comment">//获取当前的 token（我们建议从cookie或本地存储中获取token）</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$apolloHelpers<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token comment">/* 如果不是'apollo-token'，则可以提供命名的tokenName。 */</span><span class="token punctuation">)</span>
</code></pre></div><p>看看<a href="https://github.com/nuxt-community/apollo-module/tree/master/test/fixture" target="_blank" rel="noopener noreferrer">完整的例子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>对于永久授权 token，您可以通过 <code>getAuth</code> 函数来进行个性化配置：</p> <div class="language-js extra-class"><pre class="language-js"><code>apollo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    clientConfigs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        httpEndpoint<span class="token punctuation">:</span> <span class="token string">'https://graphql.datocms.com'</span><span class="token punctuation">,</span>
        getAuth<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'Bearer your_token_string'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>user login</p> <div class="language-js extra-class"><pre class="language-js"><code>methods<span class="token punctuation">:</span><span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">onSubmit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> credentials <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>credentials
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$apollo<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            mutation<span class="token punctuation">:</span> authenticateUserGql<span class="token punctuation">,</span>
            variables<span class="token punctuation">:</span> credentials
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>authenticateUser<span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$apolloHelpers<span class="token punctuation">.</span><span class="token function">onLogin</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>user logout</p> <div class="language-js extra-class"><pre class="language-js"><code>methods<span class="token punctuation">:</span><span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">onLogout</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$apolloHelpers<span class="token punctuation">.</span><span class="token function">onLogout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>getToken</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// middleware/isAuth.js</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>app<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hasToken <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>app<span class="token punctuation">.</span>$apolloHelpers<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>errorCode<span class="token punctuation">:</span><span class="token number">503</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span><span class="token string">'You are not allowed to see this'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>apolloProvider默认访问客户端的示例</p> <p>Vuex actions</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span> <span class="token punctuation">(</span>store<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>apolloProvider<span class="token punctuation">.</span>defaultClient
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>asyncData/fetch 该方法只能用于 <code>page</code> 和 <code>component</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">asyncData</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> context<span class="token punctuation">.</span>app<span class="token punctuation">.</span>apolloProvider<span class="token punctuation">.</span>defaultClient
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>nuxtServerInit</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">nuxtServerInit</span> <span class="token punctuation">(</span>store<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> client <span class="token operator">=</span> context<span class="token punctuation">.</span>app<span class="token punctuation">.</span>apolloProvider<span class="token punctuation">.</span>defaultClient
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>访问客户端或在组件内部调用 <code>mutate</code> 和 <code>query</code> 方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// receive the associated Apollo client </span>
      <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$apollo<span class="token punctuation">.</span><span class="token function">getClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment">// most likely you would call mutations like following:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$apollo<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mutation<span class="token punctuation">,</span> variables<span class="token punctuation">}</span><span class="token punctuation">)</span>
      
      <span class="token comment">// but you could also call queries like this:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$apollo<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>query<span class="token punctuation">,</span> variables<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// do what you want with data</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>获得客户端后，您可以访问其方法和属性。请参阅<a href="https://akryum.github.io/vue-apollo/api/dollar-apollo.html" target="_blank" rel="noopener noreferrer">API参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>组件的智能查询</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span>  <span class="token keyword">default</span> <span class="token punctuation">{</span> 
  apollo<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
    foo<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
      query<span class="token punctuation">:</span> fooGql<span class="token punctuation">,</span>
       <span class="token function">variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token punctuation">{</span> 
          myVar<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>myVar 
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>有关智能查询的更多信息，请参阅<a href="https://akryum.github.io/vue-apollo/guide/apollo/queries.html" target="_blank" rel="noopener noreferrer">vue-apollo文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>在node_modules上添加GQL文件识别</p> <div class="language-js extra-class"><pre class="language-js"><code>apollo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    clientConfigs<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'~/apollo/client-configs/default.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    includeNodeModules<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="升级"><a href="#升级" aria-hidden="true" class="header-anchor">#</a> 升级</h2> <p>升级指南apollo-module v3 =&gt; v4</p> <p>此模块的第4版将使您保持零配置。这意味着我们使用 <code>vue-cli-plugin-apollo</code> 提供的最佳方法，并且使用相同的配置行为。这意味着您不需要连接自己的配置，只需传递即可</p> <p>按照以下方式编辑配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// nuxt.config.js</span>
apollo<span class="token punctuation">:</span><span class="token punctuation">{</span>
 clientConfigs<span class="token punctuation">:</span><span class="token punctuation">{</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
    httpEndpoint<span class="token punctuation">:</span> <span class="token constant">YOUR_ENDPOINT</span><span class="token punctuation">,</span>
    wsEndpoint<span class="token punctuation">:</span> <span class="token constant">YOUR_WS_ENDPOINT</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="故障排除"><a href="#故障排除" aria-hidden="true" class="header-anchor">#</a> 故障排除</h2> <p>使用*.gql文件</p> <p>要使用*gql | graphql文件，您需要向项目添加以下依赖项：</p> <div class="language-js extra-class"><pre class="language-js"><code>yarn add graphql<span class="token operator">-</span>tag
<span class="token constant">OR</span>
npm install graphql<span class="token operator">-</span>tag
</code></pre></div><p>代理</p> <p>CORS错误通常通过代理解决。如果您在客户端控制台中看到Cross-Origin-Request错误，请查看设置代理。查看<a href="https://github.com/nuxt-community/proxy-module" target="_blank" rel="noopener noreferrer">proxy-module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，以便快速直接地进行设置。</p> <p>ctx.req.session - req未定义</p> <p>这只是一个占位符。您需要将其替换为您选择存储令牌的任何存储机制。这是使用本地存储的<a href="https%EF%BC%9A//github.com/Akryum/vue-apollo/issues/144">示例</a></p> <h2 id="贡献和连线设置"><a href="#贡献和连线设置" aria-hidden="true" class="header-anchor">#</a> 贡献和连线设置</h2> <p>在根文件夹中的.env文件中设置所需的字段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .env</span>
<span class="token constant">HTTP_ENDPOINT</span><span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>your<span class="token operator">-</span>endpoint
<span class="token constant">WS_ENDPOINT</span><span class="token operator">=</span>wss<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>your<span class="token operator">-</span>endpoint
</code></pre></div><p>在index.vue中，登录时要求gql必须启用 <code>mutation</code> (该mutation返回有效的token)：</p> <div class="language-js extra-class"><pre class="language-js"><code>mutation <span class="token function">authenticateUser</span><span class="token punctuation">(</span>$email<span class="token punctuation">:</span>String<span class="token operator">!</span><span class="token punctuation">,</span>$password<span class="token punctuation">:</span>String<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">authenticateUser</span><span class="token punctuation">(</span>email<span class="token punctuation">:</span> $email<span class="token punctuation">,</span> password<span class="token punctuation">:</span> $password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        token
        id
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果您的gql后端已经准备好，那么开始运行nuxt，如下所示</p> <div class="language-js extra-class"><pre class="language-js"><code># npm install
# npm run dev
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/nuxt/introduction.html" class="prev">
          介绍
        </a></span> <span class="next"><a href="/nuxt/OfficialModules/Auth.html">
          🔑 Auth
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.48493ac0.js" defer></script><script src="/assets/js/21.a5434e0f.js" defer></script>
  </body>
</html>
